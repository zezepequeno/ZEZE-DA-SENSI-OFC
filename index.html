import { 
    loginGoogle, 
    logout, 
    watchAuth, 
    getOrCreateUser 
} from "./firebase.js";

import { gerarSensi } from "./sensi.js";

/* ===============================
   EXPOR FUNÇÕES GLOBALMENTE
================================ */
window.loginGoogle = loginGoogle;
window.logout = logout;
window.gerarSensi = gerarSensi;

/* ===============================
   ELEMENTOS
================================ */
const loginBox = document.getElementById("loginBox");
const perfil = document.getElementById("perfil");
const painel = document.getElementById("painel");
const emailEl = document.getElementById("email");
const vipStatus = document.getElementById("vipStatus");
const vipCTA = document.getElementById("vipCTA");

/* ===============================
   AUTH FLOW
================================ */
watchAuth(async (user) => {
    if (user) {
        loginBox.style.display = "none";
        perfil.style.display = "block";
        painel.style.display = "block";

        emailEl.textContent = user.email;

        const data = await getOrCreateUser(user);

        if (data && data.vip) {
            vipStatus.textContent = "VIP";
            vipStatus.classList.remove("free");
            vipStatus.classList.add("vip");
            vipCTA.style.display = "none";
        } else {
            vipStatus.textContent = "FREE";
            vipCTA.style.display = "block";
        }
    } else {
        loginBox.style.display = "block";
        perfil.style.display = "none";
        painel.style.display = "none";
    }
});
